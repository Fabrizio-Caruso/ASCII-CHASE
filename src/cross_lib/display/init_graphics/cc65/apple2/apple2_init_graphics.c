/*

push bp
    mov bp, sp
    push es
    xor ax, ax
    mov al, [bp+8] ; y
    mov di, ax
    shl ax, 1
    shl ax, 1
    add ax, di ; ax = y*5
    mov cl, 6
    shl ax, cl ; ax = y*320
    xor ax, ax
    mov al, [bp+10]  ; ax = x
    add ax, di ; ax = y*320+x
    mov cl, 3
    shl ax, cl ; ax = (y*8)*320 + x*8
    mov di, ax
    mov si, [bp+2] ; tile base pointer
    xor ax, ax
    mov al, [bp+6]
    shl ax, cl ; cl was still 3, ax = idx*8 - 8 bytes per tile
    mov si, ax
    mov ax, 0a000h
    push ax
    pop es
    xor ax, ax
    mov al, [bp+4]
    mov cx, 8
  outer_loop:
    push cx
    mov cx, 8
    mov bl, [si]
  inner_loop:
    shl bl, 1
    jc write_label
    mov [es:di], ah
    inc di
    loop loop_label
    jmp out_inner_loop
  write_label:
    stosb
    loop loop_label
  out_inner_loop:
    pop cx
    add di, 312
    inc si
    loop outer_loop
    pop es
    pop bp
    ret
    
*/

/* Entry points
$F3D8 - HGR2
$F3E2 - HGR
$F605 - XDRAW
$F661 - DRAW
$F6E9 - HCOLOR
$F6FD - HPLOT
$F721 - ROT
$F727 - SCALE 
*/


#include <peekpoke.h>
#include "standard_libs.h"

uint16_t HB[]={
0x2000, 0x2400, 0x2800, 0x2C00, 0x5000, 0x5400, 0x5800, 0x5C00,
0x2080, 0x2480, 0x2880, 0x2C80, 0x5080, 0x5480, 0x5880, 0x5C80,
0x2100, 0x2500, 0x2900, 0x2D00, 0x5100, 0x5500, 0x5900, 0x5D00,
0x2180, 0x2580, 0x2980, 0x2D80, 0x5180, 0x5580, 0x5980, 0x5D80,
0x2200, 0x2600, 0x2A00, 0x2E00, 0x5200, 0x5600, 0x5A00, 0x5E00,
0x2280, 0x2680, 0x2A80, 0x2E80, 0x5280, 0x5680, 0x5A80, 0x5E80,
0x2300, 0x2700, 0x2B00, 0x2F00, 0x5300, 0x5700, 0x5B00, 0x5F00,
0x2380, 0x2780, 0x2B80, 0x2F80, 0x5380, 0x5780, 0x5B80, 0x5F80,
0x2028, 0x2428, 0x2828, 0x2C28, 0x5028, 0x5428, 0x5828, 0x5C28,
0x20A8, 0x24A8, 0x28A8, 0x2CA8, 0x50A8, 0x54A8, 0x58A8, 0x5CA8,
0x2128, 0x2528, 0x2928, 0x2D28, 0x5128, 0x5528, 0x5928, 0x5D28,
0x21A8, 0x25A8, 0x29A8, 0x2DA8, 0x51A8, 0x55A8, 0x59A8, 0x5DA8,
0x2228, 0x2628, 0x2A28, 0x2E28, 0x5228, 0x5628, 0x5A28, 0x5E28,
0x22A8, 0x26A8, 0x2AA8, 0x2EA8, 0x52A8, 0x56A8, 0x5AA8, 0x5EA8,
0x2328, 0x2728, 0x2B28, 0x2F28, 0x5328, 0x5728, 0x5B28, 0x5F28,
0x23A8, 0x27A8, 0x2BA8, 0x2FA8, 0x53A8, 0x57A8, 0x5BA8, 0x5FA8,
0x2050, 0x2450, 0x2850, 0x2C50, 0x5050, 0x5450, 0x5850, 0x5C50,
0x20D0, 0x24D0, 0x28D0, 0x2CD0, 0x50D0, 0x54D0, 0x58D0, 0x5CD0,
0x2150, 0x2550, 0x2950, 0x2D50, 0x5150, 0x5550, 0x5950, 0x5D50,
0x21D0, 0x25D0, 0x29D0, 0x2DD0, 0x51D0, 0x55D0, 0x59D0, 0x5DD0,
0x2250, 0x2650, 0x2A50, 0x2E50, 0x5250, 0x5650, 0x5A50, 0x5E50,
0x22D0, 0x26D0, 0x2AD0, 0x2ED0, 0x52D0, 0x56D0, 0x5AD0, 0x5ED0,
0x2350, 0x2750, 0x2B50, 0x2F50, 0x5350, 0x5750, 0x5B50, 0x5F50,
0x23D0, 0x27D0, 0x2BD0, 0x2FD0, 0x53D0, 0x57D0, 0x5BD0, 0x5FD0};


void _XL_INIT_GRAPHICS(void)
{
    
    // __asm__("JSR $F3E2");
    
    // TEXT OFF
    POKE(0xC050,0);
    
    // MIXED OFF
    POKE(0xC052,0);

    // HGR PAGE 1
    POKE(0xC054,0);
    
    // HGR PAGE 2
    // POKE(0xC055,0);    
    
    // HIGH RES ON
    POKE(0xC057,0);
    
    {
        uint8_t i;
        uint8_t j;
        
        for(i=0;i<192;++i)
        {
            for(j=0;j<128;++j)
            {
                POKE(HB[i]+j,255);
            }
        }
    
        // while(1){}
    }
}
